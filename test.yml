name: Create Issue on PR Merge with UI-changes Label

on:
  pull_request:
    types: [push]

jobs:
  create_issue:
    runs-on: self-hosted
    steps:
      - name: Debug Labels
        run: |
          echo "Labels on the PR: ${{ toJson(github.event.pull_request.labels) }}"

      - name: Check for specific label
        id: check_label
        run: |
          echo "Checking for the 'UI-changes' label..."
          if echo "${{ github.event.pull_request.labels[*] }}" | grep -q "UI-changes"; then
            echo "Label 'UI-changes' found."
            echo "::set-output name=label_found::true"
          else
            echo "Label 'UI-changes' not found. Exiting."
            echo "::set-output name=label_found::false"
            exit 0
          fi

      - name: Create issue
        if: steps.check_label.outputs.label_found == 'true'
        uses: peter-evans/create-issue-from-file@v5
        with:
          title: 'A PR with UI-changes label was merged!'
          content-filepath: .github/ISSUE_TEMPLATE/ui_changes_template.md
          labels: 'UI-review, test, e2e'
